# 层叠

**层叠**决定了如何解决冲突。

层叠会依据三种条件解决冲突：

1. **样式表的来源**：样式从哪里来的，包括你的样式和浏览器默认样式表等。
2. **选择器优先级**：哪些选择器比另一些选择器更重要。
3. **源码顺序**：样式在样式表里的声明顺序。

## 样式表的来源

你的样式表属于**作者**样式表，除此之外还有用户代理样式表，即浏览器默认样式表。

> 说明
>
> 某些浏览器允许用于定义一个**用户样式表**。它是第三种来源，它的优先级介于用户样式表和作者样式表之间。

### 用户代理样式（浏览器默认样式表）

浏览器应用了用户代理样式后才会应用你的样式表，即作者样式表。你指定的声明会覆盖用户代理样式表里的样式。如果你在 HTML 里面链接了多个样式表，那么它们的来源都是相同的，都属于作者样式表。

### important 声明

样式来源规则中有一个例外：标记为 `!important` 的声明。标记了 `!important` 的声明会被当做更高优先级的来源。

因此，总体的优先级按照由高到低的排列如下所示：

1. 作者的 `!important`
2. 作者
3. 用户代理

层叠独立地解决了网页中每个元素中的每个样式属性的冲突。

## 理解优先级

如果无法用来解决冲突声明，浏览器会尝试检查它们的**优先级**。

浏览器将优先级分为两部分：HTML 的行内样式和选择器的样式。

### 行内样式

如果用 HTML 的 style 属性写样式，这个声明只会作用于当前元素。实际上行内样式属于“带作用域的”声明，它会覆盖任何来自样式表（包括 作者样式表，用户代理样式表）或者\<style\>标签的样式。

如果需要覆盖行内样式声明，需要为声明添加 `!important`，这样能将它提升到一个更高优先级的来源。但如果行内样式也被标记为 `!important`，就无法覆盖它了。

> 注意
>
> 尽量减少行内样式的使用，因为它不好覆盖。

### 选择器优先级

优先级的第二部分由选择器决定。

不同类型的选择器有不同的优先级。比如，ID 选择器比类选择器优先级更高。实际上，ID 选择器的优先级比拥有任意多个类的选择器都高。同理，类选择器的优先级比标签选择器（也称**类型选择器**）更高。

优先级的准确规则如下：

- 如果选择器的 ID 数量更多，则它会胜出。
- 如果 ID 数量一致，那么拥有最多类的选择器胜出。
- 如果以上两次比较都一致，那么拥有最多标签名的选择器会胜出。

> 说明
>
> 伪类选择器（如：hover）和属性选择器（如[type="input"]）与一个类选择器的优先级相同。通用选择器（\*）和组合器（\>、\+、~）对优先级没有影响。

如果你在 CSS 里写了一个声明，但是没有生效，一般是因为被更高优先级的规则覆盖了。

如果你不理解优先级，就无法弄清楚为什么一个规则能生效，另一个却不能。

### 优先级标记

一个常用的表示优先级的方式是用数字形式来标记，通常用逗号隔开每个数。比如，“1，2，2”表示选择器由 1 个 ID、2 个类和 2 个标签元素组成。优先级最高的 ID 列为第一位，紧接着是类，最后是标签。

### 关于优先级的思考

一旦引入一个 `!important`，就会带来更多的 `!important`。

通常最好让优先级尽可能低，这样当需要覆盖一些样式时，才能有选择的空间。

## 源码顺序

如果两个声明的来源和优先级相同，其中一个声明在样式表中出现较晚，或者位于页面较晚引入的样式表中，则该声明胜出。

面对一个样式问题时，我经常分两个步骤来解决它。首先确定哪些声明可以实现效果。其次，思考可以用哪些选择器结构，然后选择最符合需求的那个。

浏览器遵循三个步骤，即来源、优先级、源码顺序，来解析网页上每个元素的每个属性。如果一个声明在层叠中“胜出”，它就被称作一个**层叠值**。

## 两条经验法则

1. **在选择其中不要使用 ID**。就算只用一个 ID，也会大幅提升优先级。当需要覆盖这个选择器时，通常找不到另一个有意义的 ID，于是就会复制原来的选择器，然后加上另一个类，让它区别于想要覆盖的选择器。

2. 不要使用`!important`。它比 ID 更难覆盖，一旦用了它，想要覆盖原先的声明，就需要再加上一个`!important`，而且依然要处理优先级的问题。

这两条规则是很好的建议，但不必固守它们，因为也有例外。不要为了赢得优先级竞赛而习惯性地使用这两个方法。
